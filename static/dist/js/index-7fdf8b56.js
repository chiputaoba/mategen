import{d as U,p as r,ab as J,r as Q,C as X,$ as G,o as A,c as F,b as l,a as c,w as v,F as H,e as W,K as Y,a0 as Z,ai as ee,t as N,L as z,aj as q,J as _,ak as se,al as h,ae as P,am as M,f as te,U as ae,N as oe,an as ne,ao as le,ap as ce,X as ie,_ as O,I as ue,l as de,x as _e,a6 as re,aq as pe,ag as me}from"./index-67479de6.js";import{S as ge}from"./index-2809fbc3.js";import"./svg-icons-d473d0e7.js";const ve={class:"kb-detail"},fe={class:"kb-right-top"},he={class:"kb-right-search"},ke={class:"kb-right-content"},ye={class:"grid-content ep-bg-purple"},we={class:"file-name"},be={class:"file-content"},xe={class:"file-content-type"},De={class:"tool-tips"},Se={class:"group-btn"},Ce=U({__name:"Detail",emits:["showSessions"],setup(j,{expose:I,emit:f}){const m=r(),n=J({showDialog:!1,kb_id:"",item:r()}),i=r({kb_id:"",knowledge_base_name:"",chunking_strategy:"auto",max_chunk_size_tokens:0,chunk_overlap_tokens:0,folder_path_base:""}),p=r(""),a=r([]),g=r([]),K=()=>{p.value?g.value=a.value.filter(e=>e.filename.substring(0,e.filename.lastIndexOf(".")).indexOf(p.value)!==-1):g.value=a.value},E=async e=>{var s,o,w,b,x,D,S,C,k,u,B,L,V;if(!e){_({type:"error",message:"参数异常",customClass:"custom-message"});return}try{n.kb_id=e.id,n.item=e,i.value.knowledge_base_name=e.item.knowledge_base_name,i.value.chunking_strategy=e.item.chunking_strategy,i.value.max_chunk_size_tokens=e.item.max_chunk_size_tokens,i.value.chunk_overlap_tokens=e.item.chunk_overlap_tokens,i.value.folder_path_base="",n.showDialog=!0,a.value=[],g.value=[];const d=await se(n.kb_id);d.status===200&&((s=d.data)==null?void 0:s.status)===200&&(a.value=[...a.value,...h((w=(o=d.data.data)==null?void 0:o.data)==null?void 0:w[".md"])],a.value=[...a.value,...h((x=(b=d.data.data)==null?void 0:b.data)==null?void 0:x[".pdf"])],a.value=[...a.value,...h((S=(D=d.data.data)==null?void 0:D.data)==null?void 0:S[".doc"])],a.value=[...a.value,...h((k=(C=d.data.data)==null?void 0:C.data)==null?void 0:k[".docx"])],a.value=[...a.value,...h((B=(u=d.data.data)==null?void 0:u.data)==null?void 0:B[".ppt"])],a.value=[...a.value,...h((V=(L=d.data.data)==null?void 0:L.data)==null?void 0:V[".pptx"])],g.value=a.value)}catch(d){console.log(" error",d)}},$=async()=>{n.showDialog=!1},R=async e=>{P.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var s;try{const o=await M(e);o.status===200&&((s=o.data)==null?void 0:s.status)===200&&(_({type:"success",message:"知识库删除成功",customClass:"custom-message"}),t("showSessions"),n.showDialog=!1)}catch{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{})},T=async()=>{var e;(e=m.value)==null||e.openUpDialog(n.item)},y=()=>{t("showSessions")};I({openDetail:E,closeDetail:$});const t=f;return(e,s)=>{const o=Q("search"),w=te,b=ae,x=oe,D=ne,S=le,C=ce,k=ie;return X((A(),F("div",ve,[l("div",fe,[s[3]||(s[3]=l("div",{class:"kb-right-top-title"},"文件列表",-1)),l("div",he,[c(b,{class:"kb-right-search-input",modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=u=>p.value=u),placeholder:"请输入文件名称",onInput:K},{suffix:v(()=>[c(w,{class:"el-input__icon"},{default:v(()=>[c(o)]),_:1})]),_:1},8,["modelValue"])])]),l("div",ke,[c(C,{gutter:20},{default:v(()=>[(A(!0),F(H,null,W(g.value,(u,B)=>(A(),Y(S,{span:8,key:B},{default:v(()=>[l("div",ye,[c(x,{"icon-class":Z(ee)(u.filename),className:"pdf-svg"},null,8,["icon-class"]),c(D,{class:"box-item",effect:"dark",content:u.filename,placement:"top"},{default:v(()=>[l("span",we,N(u.filename),1)]),_:2},1032,["content"])])]),_:2},1024))),128))]),_:1})]),l("div",be,[s[5]||(s[5]=l("span",{class:"file-content-name"},"chunking_stategy 参数：",-1)),l("div",xe,[s[4]||(s[4]=l("span",null,"手动",-1)),l("div",De," chunk_size："+N(i.value.max_chunk_size_tokens)+"    chunk__overlap_tokens："+N(i.value.chunk_overlap_tokens),1)])]),l("div",Se,[c(k,{class:"primary-btn",type:"primary",onClick:s[1]||(s[1]=u=>T())},{default:v(()=>s[6]||(s[6]=[z(" 编辑 ")])),_:1}),c(k,{class:"default-btn",plain:"",onClick:s[2]||(s[2]=u=>R(n.kb_id))},{default:v(()=>s[7]||(s[7]=[z(" 删除 ")])),_:1})]),c(q,{ref_key:"AddDialogRef",ref:m,onShowSessions:y},null,512)],512)),[[G,n.showDialog]])}}});const Be=O(Ce,[["__scopeId","data-v-c5245dbb"]]),Ae={class:"kb"},Ie={class:"kb-right"},Ke=U({__name:"index",setup(j){const{proxy:I}=_e(),f=r(),m=r(),n=r({knowledge_new_name:"",init:!1}),i=r([]);I.$mitt.on("showAllKB",()=>{ue(async()=>{p()})});const p=async()=>{var t;try{i.value=[];const e=await re();e.status===200&&((t=e.data)==null?void 0:t.status)===200&&e.data.data&&e.data.data.length>0&&(i.value=e.data.data.map(s=>({id:s.knowledge_base_id,name:s.knowledge_base_name,item:s})))}catch(e){console.log("getAllKnowledgeAPI error",e)}},a=()=>{var t;p(),(t=f.value)==null||t.closeDetail()},g=()=>{var t;(t=m.value)==null||t.openDialog()},K=t=>{var e;(e=f.value)==null||e.openDetail(t)},E=async t=>{var s;const e=_({type:"info",message:"知识库重命名中...",customClass:"custom-loading-message"});try{n.value={knowledge_new_name:"",init:!1},n.value.knowledge_new_name=t.name,n.value.init=!1;let o=await pe(t.id,n.value);o.status===200&&((s=o.data)==null?void 0:s.status)===200?(e.close(),_({type:"success",message:"知识库重命名成功！",customClass:"custom-message"}),a()):(e.close(),_({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"}))}catch{e.close(),_({type:"error",message:"知识库重命名失败，请重试！",customClass:"custom-message"})}},$=t=>{var e;(e=m.value)==null||e.openUpDialog(t)},R=t=>{T(t.id)},T=async t=>{P.confirm("确认后该知识库会被删除，且不可恢复","确认删除？",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info",customClass:"custom-message-box"}).then(async()=>{var e,s;try{const o=await M(t);o.status===200&&((e=o.data)==null?void 0:e.status)===200&&(_({type:"success",message:"知识库删除成功",customClass:"custom-message"}),p(),(s=f.value)==null||s.closeDetail())}catch{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})}}).catch(()=>{_({type:"error",message:"知识库删除失败",customClass:"custom-message"})})},y=me();return de(()=>{var t;if(y.query.type&&y.query.type==="add"){(t=m.value)==null||t.openDialog();const e=window.location.hash.replace(/\?.*$/,"");history.replaceState({},"",e)}p()}),(t,e)=>(A(),F("div",Ae,[c(ge,{title:"添加知识库","session-type":"KB",list:i.value,onAddSession:g,onQuerySession:K,onEditSession:$,onEditSessionName:E,onDeleteSession:R},null,8,["list"]),l("div",Ie,[c(Be,{ref_key:"DetailRef",ref:f,onShowSessions:a},null,512)]),c(q,{ref_key:"AddDialogRef",ref:m,onShowSessions:a},null,512)]))}});const Te=O(Ke,[["__scopeId","data-v-f61c8f09"]]);export{Te as default};
